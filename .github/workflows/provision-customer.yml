- name: Locate and Initialize Terraform
        run: |
          # 1. إيجاد المجلد الصحيح
          TF_PATH=$(find . -name "main.tf" -not -path "*/.*" -print -quit)
          TF_DIR=$(dirname "$TF_PATH")
          echo "Found main.tf in: $TF_DIR"
          cd "$TF_DIR"

          # 2. التأكد من وجود الـ variables داخل الملف فعلياً (للأمان)
          echo "Checking variables in main.tf..."
          grep "variable" main.tf

          # 3. الـ Initialization
          echo "Running Terraform Init..."
          terraform init -reconfigure \
            -backend-config="bucket=hosting-company-terraform-state-093063750620" \
            -backend-config="region=us-east-2" \
            -backend-config="dynamodb_table=terraform-state-locks" \
            -backend-config="encrypt=true"

          # 4. الـ Apply (لازم يفضل في نفس بلوك الـ run لضمان المسار)
          echo "Running Terraform Apply..."
          terraform apply -auto-approve \
            -var="customer_domain=${{ github.event.client_payload.domain }}" \
            -var="customer_email=${{ github.event.client_payload.email }}" \
            -var="plan_tier=${{ github.event.client_payload.tier }}" \
            -var="client_id=${{ github.event.client_payload.client_id }}"
